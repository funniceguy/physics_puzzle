(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const p=400,m=600,u=50,S=100,a="https://raw.githubusercontent.com/twitter/twemoji/master/assets/72x72/",d=[{radius:12,score:10,img:a+"1f352.png"},{radius:18,score:20,img:a+"1f353.png"},{radius:24,score:40,img:a+"1f347.png"},{radius:30,score:80,img:a+"1f34a.png"},{radius:38,score:160,img:a+"1f34b.png"},{radius:46,score:320,img:a+"1f348.png"},{radius:54,score:640,img:a+"1f34d.png"},{radius:64,score:1280,img:a+"1f351.png"},{radius:76,score:2560,img:a+"1f34f.png"},{radius:88,score:5120,img:a+"1f34e.png"},{radius:104,score:10240,img:a+"1f349.png"}],g={FRICTION:.3,RESTITUTION:.2,DENSITY:.001},I={RESTITUTION_PER_LEVEL:.08,FRICTION_PER_LEVEL:-.03,EXPLOSION_PER_LEVEL:.05},M=.08,y=[0,3e3,8e3,15e3,25e3,4e4,6e4,85e3,115e3,15e4],L=400;class x{constructor(e){this.Engine=Matter.Engine,this.Render=Matter.Render,this.Runner=Matter.Runner,this.Composite=Matter.Composite,this.Bodies=Matter.Bodies,this.Events=Matter.Events,this.engine=this.Engine.create(),this.world=this.engine.world;const i=document.getElementById(e);this.render=this.Render.create({canvas:i,engine:this.engine,options:{width:p,height:m,wireframes:!1,background:"#2a2a2a"}}),this.createBoundaries(),this.Render.run(this.render),this.runner=this.Runner.create(),this.Runner.run(this.runner,this.engine)}createBoundaries(){const e=this.Bodies.rectangle(p/2,m+u/2,p,u,{isStatic:!0,render:{visible:!1}}),i=this.Bodies.rectangle(-u/2,m/2,u,m*2,{isStatic:!0,render:{visible:!1}}),t=this.Bodies.rectangle(p+u/2,m/2,u,m*2,{isStatic:!0,render:{visible:!1}});this.Composite.add(this.world,[e,i,t])}addBody(e){this.Composite.add(this.world,e)}removeBody(e){this.Composite.remove(this.world,e)}}class C{static create(e,i,t){const s=d[t],r=s.radius,n=Matter.Bodies.circle(e,i,r,{restitution:g.RESTITUTION,friction:g.FRICTION,density:g.DENSITY,render:{sprite:{texture:s.img,xScale:r*2/72,yScale:r*2/72}},label:"circle"});return n.gameData={level:t,hasMerged:!1},n}}class B{constructor(){this.scoreElement=document.getElementById("score"),this.targetScoreElement=document.getElementById("target-score"),this.levelElement=document.getElementById("level"),this.nextCircleElement=document.getElementById("next-circle"),this.scoreIcon=document.getElementById("score-icon"),this.resultScreen=document.getElementById("result-screen"),this.resultTitle=document.getElementById("result-title"),this.resultScore=document.getElementById("result-score"),this.resultButton=document.getElementById("result-button"),this.effectsContainer=document.getElementById("effects-container"),this.btnRemove=document.getElementById("btn-remove"),this.btnUpgrade=document.getElementById("btn-upgrade"),this.btnVibration=document.getElementById("btn-vibration"),this.itemButtons={remove:this.btnRemove,upgrade:this.btnUpgrade,vibration:this.btnVibration},this.currentDisplayedScore=0,this.targetScore=0,this.scoreAnimationId=null}updateScore(e,i){this.targetScore=e,this.scoreAnimationId||this.animateScore();const t=y[i]||"MAX";this.targetScoreElement.textContent=t}animateScore(){if(this.currentDisplayedScore<this.targetScore){const e=this.targetScore-this.currentDisplayedScore,i=Math.ceil(e/10);this.currentDisplayedScore+=i,this.scoreElement.textContent=this.currentDisplayedScore,this.scoreAnimationId=requestAnimationFrame(()=>this.animateScore())}else this.currentDisplayedScore=this.targetScore,this.scoreElement.textContent=this.currentDisplayedScore,this.scoreAnimationId=null}updateLevel(e){this.levelElement.textContent=e}updateNextCircle(e){const i=d[e];this.nextCircleElement.innerHTML="";const t=document.createElement("img");t.src=i.img,t.style.width="100%",t.style.height="100%",t.style.objectFit="contain",this.nextCircleElement.appendChild(t)}showResult(e,i){this.resultScreen.style.display="flex",this.resultTitle.textContent=i?"MISSION COMPLETE!":"GAME OVER",this.resultScore.textContent=`Final Score: ${e}`,this.resultTitle.style.color=i?"#00FF00":"#FF0000",this.resultButton.textContent="Play Again",this.resultButton.onclick=()=>location.reload()}showMissionComplete(e,i,t,s){this.resultScreen.style.display="flex",this.resultTitle.textContent=`LEVEL ${e} CLEARED!`,this.resultTitle.style.color="#00FFFF";const r={remove:"üóëÔ∏è",upgrade:"‚¨ÜÔ∏è",vibration:"üì≥"},n={remove:"Remove",upgrade:"Upgrade",vibration:"Vibration"};this.resultScore.innerHTML=`Current Score: ${i}<br><br>üéÅ Acquired: ${r[t]} ${n[t]}`,this.resultButton.textContent="Next Level",this.resultButton.onclick=()=>{this.resultScreen.style.display="none",s()}}toggleItemActive(e,i){Object.values(this.itemButtons).forEach(t=>t.classList.remove("active")),i&&this.itemButtons[e]&&this.itemButtons[e].classList.add("active")}setupItemListeners(e){this.btnRemove.onclick=()=>e("remove"),this.btnUpgrade.onclick=()=>e("upgrade"),this.btnVibration.onclick=()=>e("vibration")}updateItemCount(e,i){const t=this.itemButtons[e];if(!t)return;let s=t.querySelector(".item-count");s||(s=document.createElement("span"),s.className="item-count",t.appendChild(s)),s.textContent=i,i<=0?t.classList.add("disabled"):t.classList.remove("disabled")}updateAllItemCounts(e){this.updateItemCount("remove",e.remove),this.updateItemCount("upgrade",e.upgrade),this.updateItemCount("vibration",e.vibration)}spawnMergeEffect(e,i,t){const s=this.scoreIcon.getBoundingClientRect(),r=document.getElementById("game-container").getBoundingClientRect(),n=s.left-r.left+s.width/2,l=s.top-r.top+s.height/2;for(let c=0;c<5;c++){const o=document.createElement("div");o.className="star",o.textContent="‚≠ê",o.style.left=e+(Math.random()*40-20)+"px",o.style.top=i+(Math.random()*40-20)+"px";const h=o.animate([{transform:"scale(0.5) rotate(0deg)",opacity:1,left:o.style.left,top:o.style.top},{transform:"scale(0.2) rotate(360deg)",opacity:0,left:n+"px",top:l+"px"}],{duration:800+Math.random()*400,easing:"ease-in",fill:"forwards"});this.effectsContainer.appendChild(o),h.onfinish=()=>{o.remove(),this.triggerScoreFlash()}}}triggerScoreFlash(){this.scoreIcon.classList.remove("flash"),this.scoreIcon.offsetWidth,this.scoreIcon.classList.add("flash")}}class R{constructor(){this.physics=new x("world"),this.ui=new B,this.score=0,this.level=1,this.nextCircleLevel=0,this.currentCircle=null,this.canDrop=!0,this.isGameOver=!1,this.isMissionComplete=!1,this.activeItem=null,this.activeVibrations=[],this.itemInventory={remove:3,upgrade:3,vibration:3},this.setupInput(),this.setupUI(),this.setupCollision(),this.setupGameLoop(),this.spawnNextCircle(),this.ui.updateScore(this.score,this.level),this.ui.updateAllItemCounts(this.itemInventory)}setupUI(){this.ui.setupItemListeners(e=>{this.activeItem===e?(this.activeItem=null,this.ui.toggleItemActive(e,!1)):(this.activeItem=e,this.ui.toggleItemActive(e,!0))})}setupInput(){const e=document.getElementById("game-container");e.addEventListener("mousemove",i=>{this.currentCircle&&this.canDrop&&!this.isGameOver&&!this.isMissionComplete&&!this.activeItem&&this.updateCurrentCirclePosition(i.clientX)}),e.addEventListener("click",i=>{this.isGameOver||this.isMissionComplete||(this.activeItem?this.handleItemClick(i):this.currentCircle&&this.canDrop&&(this.updateCurrentCirclePosition(i.clientX),this.dropCircle()))})}handleItemClick(e){if(this.itemInventory[this.activeItem]<=0){this.ui.toggleItemActive(this.activeItem,!1),this.activeItem=null;return}const i=document.getElementById("game-container").getBoundingClientRect(),t=e.clientX-i.left,s=e.clientY-i.top,n=Matter.Query.point(Matter.Composite.allBodies(this.physics.world),{x:t,y:s}).find(l=>l.label==="circle"&&!l.isStatic&&!l.isSensor);n&&(this.applyItem(n),this.itemInventory[this.activeItem]--,this.ui.updateItemCount(this.activeItem,this.itemInventory[this.activeItem]),this.ui.toggleItemActive(this.activeItem,!1),this.activeItem=null)}applyItem(e){switch(this.activeItem){case"remove":this.physics.removeBody(e),this.createParticles(e.position.x,e.position.y,"üí®");break;case"upgrade":if(e.gameData.level<d.length-1){const i=e.gameData.level+1,{x:t,y:s}=e.position;this.physics.removeBody(e);const r=C.create(t,s,i);this.applyLevelPhysics(r),this.physics.addBody(r),this.createParticles(t,s,"‚ú®")}break;case"vibration":this.applyVibration(e),this.createParticles(e.position.x,e.position.y,"üì≥");break}}applyVibration(e){this.activeVibrations.push({body:e,startTime:Date.now(),duration:3e3})}createParticles(e,i,t){this.ui.spawnMergeEffect(e,i,0)}updateCurrentCirclePosition(e){const t=document.getElementById("game-container").getBoundingClientRect();let s=e-t.left;const r=this.currentCircle.circleRadius;s=Math.max(r+u/2,Math.min(s,p-r-u/2)),Matter.Body.setPosition(this.currentCircle,{x:s,y:50})}spawnNextCircle(){if(this.isGameOver||this.isMissionComplete)return;const e=this.nextCircleLevel;this.currentCircle=C.create(p/2,50,e),this.currentCircle.isSensor=!0,this.currentCircle.isStatic=!0,this.physics.addBody(this.currentCircle),this.nextCircleLevel=Math.floor(Math.random()*3),this.ui.updateNextCircle(this.nextCircleLevel),this.canDrop=!0}dropCircle(){this.canDrop=!1,this.currentCircle.isSensor=!1,this.currentCircle.isStatic=!1,this.applyLevelPhysics(this.currentCircle),Matter.Body.setVelocity(this.currentCircle,{x:0,y:5}),this.currentCircle=null,setTimeout(()=>{this.spawnNextCircle()},L)}applyLevelPhysics(e){const i=this.level-1;e.restitution=Math.min(1.2,g.RESTITUTION+i*I.RESTITUTION_PER_LEVEL),e.friction=Math.max(0,g.FRICTION+i*I.FRICTION_PER_LEVEL)}setupCollision(){Matter.Events.on(this.physics.engine,"collisionStart",e=>{const i=e.pairs;for(let t=0;t<i.length;t++){const s=i[t].bodyA,r=i[t].bodyB;s.gameData&&r.gameData&&this.handleMerge(s,r)}})}handleMerge(e,i){if(e.gameData.level===i.gameData.level&&!e.gameData.hasMerged&&!i.gameData.hasMerged){e.gameData.hasMerged=!0,i.gameData.hasMerged=!0;const t=e.gameData.level+1,s=(e.position.x+i.position.x)/2,r=(e.position.y+i.position.y)/2;if(this.physics.removeBody(e),this.physics.removeBody(i),this.addScore(d[e.gameData.level].score*2),this.ui.spawnMergeEffect(s,r,d[e.gameData.level].score*2),this.applyExplosion(s,r,d[e.gameData.level].radius,!1),t<d.length){const n=C.create(s,r,t);this.applyLevelPhysics(n),this.physics.addBody(n)}else this.addScore(d[e.gameData.level].score*4)}}applyExplosion(e,i,t,s=!1){const r=Matter.Composite.allBodies(this.physics.world),n=this.level-1,l=M;let c;s?c=.5:c=(l+n*I.EXPLOSION_PER_LEVEL)*(t/20),r.forEach(o=>{if(o.isStatic)return;const h={x:o.position.x-e,y:o.position.y-i},v=Math.sqrt(h.x*h.x+h.y*h.y);if(v<(s?400:300)&&v>0){const E={x:h.x/v*c*o.mass,y:h.y/v*c*o.mass};Matter.Body.applyForce(o,o.position,E)}})}addScore(e){this.score+=e,this.ui.updateScore(this.score,this.level);const i=y[this.level];this.score>=i&&!this.isMissionComplete&&this.missionComplete()}missionComplete(){this.isMissionComplete=!0;const e=this.rewardRandomItem();this.ui.showMissionComplete(this.level,this.score,e,()=>{this.nextLevel()})}rewardRandomItem(){const e=["remove","upgrade","vibration"],i=e[Math.floor(Math.random()*e.length)];return this.itemInventory[i]++,this.ui.updateItemCount(i,this.itemInventory[i]),i}nextLevel(){this.level++,this.ui.updateLevel(this.level),this.ui.updateScore(this.score,this.level),this.isMissionComplete=!1,this.currentCircle&&this.physics.removeBody(this.currentCircle),this.canDrop=!1,setTimeout(()=>{this.spawnNextCircle()},1e3)}setupGameLoop(){Matter.Events.on(this.physics.engine,"afterUpdate",()=>{if(this.isGameOver||this.isMissionComplete)return;const e=Matter.Composite.allBodies(this.physics.world),i=Date.now();this.activeVibrations=this.activeVibrations.filter(t=>i-t.startTime>t.duration?(t.body&&t.body.isStatic&&Matter.Body.setStatic(t.body,!1),!1):(t.body&&!t.body.isStatic&&Matter.Body.setStatic(t.body,!0),t.body&&Matter.Body.setAngularVelocity(t.body,.15),e.forEach(s=>{if(s.isStatic||s.isSensor||s===t.body)return;const r=s.position.x-t.body.position.x,n=s.position.y-t.body.position.y;if(Math.sqrt(r*r+n*n)<250){const c=.003*s.mass;Matter.Body.applyForce(s,s.position,{x:(Math.random()-.5)*c,y:(Math.random()-.5)*c})}}),!0));for(const t of e)if(!(t.isStatic||t.isSensor)&&t.position.y<S&&t.speed<.5){this.gameOver();break}})}gameOver(){this.isGameOver=!0,this.ui.showResult(this.score,!1)}}window.addEventListener("DOMContentLoaded",()=>{new R});
